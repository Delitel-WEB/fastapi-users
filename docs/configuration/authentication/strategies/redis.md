# Redis

[Redis](https://redis.io/) - это база данных с ультра-быстрым доступом по ключу. Таким образом, он является отличным кандидатом для управления токенами. В этой стратегии токен генерируется и связывается с идентификатором пользователя в базе данных. При каждом запросе мы пытаемся извлечь этот токен из Redis, чтобы получить соответствующий идентификатор пользователя.

## Установка

Вы должны установить библиотеку с дополнительными зависимостями для Redis:

```sh
pip install 'fastapi-users[redis]'
```

## Конфигурация

```py
import redis.asyncio
from fastapi_users.authentication import RedisStrategy

redis = redis.asyncio.from_url("redis://localhost:6379", decode_responses=True)

def get_redis_strategy() -> RedisStrategy:
    return RedisStrategy(redis, lifetime_seconds=3600)
```

Как видите, создание экземпляра довольно просто. Он принимает следующие аргументы:

* `redis` (`redis.asyncio.Redis`): Экземпляр `redis.asyncio.Redis`. Обратите внимание, что флаг `decode_responses`, установленный в `True`, необходим.
* `lifetime_seconds` (`Optional[int]`): Срок действия токена в секундах. По умолчанию `None`, что означает, что токен не истекает.
* `key_prefix` (`str`): Префикс, используемый для установки ключа в хранилище Redis. По умолчанию `fastapi_users_token:`.

!!! tip "Почему это внутри функции?"
    Чтобы стратегии можно было создавать динамически с другими зависимостями, они должны предоставляться как вызываемые функции для аутентификационного бэкенда.

## Выход из системы

При выходе из системы эта стратегия удалит токен из хранилища Redis.