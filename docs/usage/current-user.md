# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**FastAPI Users** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã–∑—ã–≤–∞–µ–º—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ª–µ–≥–∫–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≤–∞—à–∏ –º–∞—Ä—à—Ä—É—Ç—ã. –û–Ω–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ –≤–∞—à–µ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `FastAPIUsers`.

!!! –°–æ–≤–µ—Ç
    –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ–º, –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É API, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π –≤–∞—à–µ–≥–æ [–º–µ—Ç–æ–¥–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏](../configuration/authentication/index.md).

## `current_user`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã–∑—ã–≤–∞–µ–º—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–µ—Ä–µ–¥–∞–≤–∞—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

* `optional`: –ï—Å–ª–∏ `True`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `None`, –µ—Å–ª–∏ –Ω–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –µ—Å–ª–∏ –æ–Ω –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥—Ä—É–≥–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è. –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `401 Unauthorized`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `False`.
* `active`: –ï—Å–ª–∏ `True`, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `401 Unauthorized`, –µ—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `False`.
* `verified`: –ï—Å–ª–∏ `True`, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `403 Forbidden`, –µ—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `False`.
* `superuser`: –ï—Å–ª–∏ `True`, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è `403 Forbidden`, –µ—Å–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `False`.
* `get_enabled_backends`: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤—ã–∑—ã–≤–∞–µ–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è —Å–ø–∏—Å–æ–∫ –≤–∫–ª—é—á–µ–Ω–Ω—ã—Ö –±—ç–∫–µ–Ω–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±—ç–∫–µ–Ω–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–Ω–µ—à–Ω–µ–π –ª–æ–≥–∏–∫–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –±—ç–∫–µ–Ω–¥—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. *–û–¥–Ω–∞–∫–æ –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –∫–∞–∂–¥—ã–π –±—ç–∫–µ–Ω–¥ –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ OpenAPI, —Ç–∞–∫ –∫–∞–∫ FastAPI —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —ç—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏.*

!!! –°–æ–≤–µ—Ç "–°–æ–∑–¥–∞–π—Ç–µ –µ–µ –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ"
    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è - **—Ñ–∞–±—Ä–∏–∫–∞**, —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é ü§Ø

    –ò–º–µ–Ω–Ω–æ —ç—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞–µ–º–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é, –∫–æ—Ç–æ—Ä—É—é FastAPI –≤—ã–∑—ã–≤–∞–µ—Ç –≤ –≤–∞—à–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö API.

    –ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –µ–µ –Ω–∞ –∫–∞–∂–¥–æ–º –º–∞—Ä—à—Ä—É—Ç–µ –∏ –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏ –º–æ–¥—É–ª—å–Ω–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏, **–Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** –ø—Ä–∏—Å–≤–æ–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –ø–æ –∂–µ–ª–∞–Ω–∏—é –≤ –≤–∞—à–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö. –ü—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–µ –Ω–∏–∂–µ –ø—Ä–∏–º–µ—Ä—ã –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—Ç —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥.

## –ü—Ä–∏–º–µ—Ä—ã

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (**–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Ç**)

```py
current_user = fastapi_users.current_user()

@app.get("/protected-route")
def protected_route(user: User = Depends(current_user)):
    return f"–ü—Ä–∏–≤–µ—Ç, {user.email}"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ **–∞–∫—Ç–∏–≤–Ω–æ–≥–æ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```py
current_active_user = fastapi_users.current_user(active=True)

@app.get("/protected-route")
def protected_route(user: User = Depends(current_active_user)):
    return f"–ü—Ä–∏–≤–µ—Ç, {user.email}"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ **–∞–∫—Ç–∏–≤–Ω–æ–≥–æ** –∏ **–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–≥–æ** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```py
current_active_verified_user = fastapi_users.current_user(active=True, verified=True)

@app.get("/protected-route")
def protected_route(user: User = Depends(current_active_verified_user)):
    return f"–ü—Ä–∏–≤–µ—Ç, {user.email}"
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ **—Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```py
current_superuser = fastapi_users.current_user(active=True, superuser=True)

@app.get("/protected-route")
def protected_route(user: User = Depends(current_superuser)):
    return f"–ü—Ä–∏–≤–µ—Ç, {user.email}"
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ –±—ç–∫–µ–Ω–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

!!! –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
    –≠—Ç–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—ç–∫–µ–Ω–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∫–ª—é—á–∞—é—Ç—Å—è —É—Å–ª–æ–≤–Ω–æ. –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –≤–∞–º –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —ç—Ç–∞ –æ–ø—Ü–∏—è.

```py
from fastapi import Request
from fastapi_users.authentication import AuthenticationBackend, BearerTransport, CookieTransport, JWTStrategy

SECRET = "SECRET"

bearer_transport = BearerTransport(tokenUrl="auth/jwt/login")
cookie_transport = CookieTransport(cookie_max_age=3600)

def get_jwt_strategy() -> JWTStrategy:
    return JWTStrategy(secret=SECRET, lifetime_seconds=3600)

jwt_backend = AuthenticationBackend(
    name="jwt",
    transport=bearer_transport,
    get_strategy=get_jwt_strategy,
)
cookie_backend = AuthenticationBackend(
    name="jwt",
    transport=cookie_transport,
    get_strategy=get_jwt_strategy,
)

async def get_enabled_backends(request: Request):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∫–ª—é—á–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ª–æ–≥–∏–∫–æ–π."""
    if request.url.path == "/protected-route-only-jwt":
        return [jwt_backend]
    else:
        return [cookie_backend, jwt_backend]


current_active_user = fastapi_users.current_user(active=True, get_enabled_backends=get_enabled_backends)


@app.get("/protected-route")
def protected_route(user: User = Depends(current_active_user)):
    return f"–ü—Ä–∏–≤–µ—Ç, {user.email}. –í—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é cookie –∏–ª–∏ JWT."


@app.get("/protected-route-only-jwt")
def protected_route(user: User = Depends(current_active_user)):
    return f"–ü—Ä–∏–≤–µ—Ç, {user.email}. –í—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é JWT."
```

## –í –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏

–ï—Å–ª–∏ –≤–∞–º –Ω–µ –Ω—É–∂–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –ª–æ–≥–∏–∫–µ –º–∞—Ä—à—Ä—É—Ç–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

```py
@app.get("/protected-route", dependencies=[Depends(current_superuser)])
def protected_route():
    return "–ü—Ä–∏–≤–µ—Ç

, –∫–∞–∫–æ–π-—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å."
```

–í—ã –º–æ–∂–µ—Ç–µ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ–± —ç—Ç–æ–º [–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ FastAPI](https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/).